generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activity_logs {
  id        String   @id
  userId    String
  action    String
  entity    String
  entityId  String?
  details   String?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([entity])
  @@index([userId])
}

model bookmarks {
  id           String   @id
  userId       String
  articleId    String
  articleTitle String
  articleUrl   String
  articleImage String?
  createdAt    DateTime @default(now())
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@index([userId])
}

model bulk_actions {
  id             String     @id
  userId         String
  action         String
  entity         String
  entityIds      String[]
  status         BulkStatus @default(PENDING)
  totalItems     Int
  processedItems Int        @default(0)
  errors         String[]   @default([])
  startedAt      DateTime?
  completedAt    DateTime?
  createdAt      DateTime   @default(now())
  users          users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}

model campaign_contacts {
  id         String    @id
  campaignId String
  contactId  String
  status     String    @default("pending")
  sentAt     DateTime?
  openedAt   DateTime?
  clickedAt  DateTime?
  createdAt  DateTime  @default(now())
  campaigns  campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  contacts   contacts  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@unique([campaignId, contactId])
}

model campaigns {
  id                String              @id
  name              String
  subject           String
  status            CampaignStatus      @default(DRAFT)
  templateId        String?
  scheduledAt       DateTime?
  sentAt            DateTime?
  totalSent         Int                 @default(0)
  totalOpened       Int                 @default(0)
  totalClicked      Int                 @default(0)
  sentCount         Int                 @default(0)
  deliveredCount    Int                 @default(0)
  openedCount       Int                 @default(0)
  clickedCount      Int                 @default(0)
  bouncedCount      Int                 @default(0)
  failedCount       Int                 @default(0)
  sendErrors        Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  campaign_contacts campaign_contacts[]
  email_templates   email_templates?    @relation(fields: [templateId], references: [id])
  drip_emails       drip_emails[]
  email_events      email_events[]
}

model categories {
  id          String       @id
  name        String
  slug        String       @unique
  description String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  wordpressId Int?         @unique
  color       String?
  icon        String?
  order       Int          @default(0)
  posts       posts[]      @relation("PostCategories")

  @@index([slug])
  @@index([wordpressId])
  @@index([order])
}

model comments {
  id          String        @id
  postId      String
  postTitle   String
  author      String
  authorEmail String
  authorUrl   String?
  content     String
  status      CommentStatus @default(PENDING)
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime

  @@index([authorEmail])
  @@index([postId])
  @@index([status])
}

model contacts {
  id                String              @id
  email             String              @unique
  firstName         String?
  lastName          String?
  phone             String?
  company           String?
  tags              String[]
  status            ContactStatus       @default(ACTIVE)
  source            String?
  notes             String?
  lastContactedAt   DateTime?
  emailEngagementScore Int              @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  campaign_contacts campaign_contacts[]
  email_logs        email_logs[]
  email_events      email_events[]
  list_members      list_members[]

  @@index([email])
  @@index([status])
}

model content_analytics {
  id             String   @id
  contentType    String
  contentId      String
  contentSlug    String
  contentTitle   String
  views          Int      @default(0)
  uniqueVisitors Int      @default(0)
  avgTimeOnPage  Int      @default(0)
  bounceRate     Float    @default(0.0)
  socialShares   Int      @default(0)
  comments       Int      @default(0)
  bookmarks      Int      @default(0)
  date           DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  metadata       String?

  @@unique([contentType, contentId, date])
  @@index([contentSlug])
  @@index([contentType])
  @@index([date])
}

model drip_emails {
  id         String    @id
  campaignId String
  name       String
  subject    String
  content    String
  delayDays  Int       @default(0)
  order      Int
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  campaigns  campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model email_events {
  id           String   @id
  campaignId   String
  contactId    String
  emailAddress String
  event        String
  eventData    Json?
  createdAt    DateTime @default(now())
  campaigns    campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  contacts     contacts  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([contactId])
  @@index([event])
}

model editorial_calendar {
  id            String          @id
  title         String
  contentType   ContentType     @default(ARTICLE)
  assignedToId  String?
  categoryId    String?
  status        EditorialStatus @default(IDEA)
  scheduledDate DateTime?
  publishDate   DateTime?
  deadline      DateTime?
  priority      Priority        @default(MEDIUM)
  notes         String?
  wordpressId   String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  users         users?          @relation(fields: [assignedToId], references: [id])

  @@index([assignedToId])
  @@index([scheduledDate])
  @@index([status])
}

model email_logs {
  id           String    @id
  contactId    String
  subject      String
  content      String
  status       String
  sentAt       DateTime  @default(now())
  openedAt     DateTime?
  clickedAt    DateTime?
  bouncedAt    DateTime?
  errorMessage String?
  contacts     contacts  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
  @@index([status])
}

model email_templates {
  id        String      @id
  name      String
  subject   String
  content   String
  isDefault Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime
  campaigns campaigns[]
}

model contact_lists {
  id           String        @id
  name         String
  description  String?
  type         ListType      @default(STATIC)
  filters      Json?
  memberCount  Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  list_members list_members[]

  @@index([type])
  @@index([createdAt])
}

model list_members {
  id         String         @id
  listId     String
  contactId  String
  addedAt    DateTime       @default(now())
  list       contact_lists  @relation(fields: [listId], references: [id], onDelete: Cascade)
  contact    contacts       @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@unique([listId, contactId])
  @@index([listId])
  @@index([contactId])
}

enum ListType {
  STATIC
  DYNAMIC
}

model magazine_subscriptions {
  id               String        @id
  subscriptionId   String        @unique
  cwSubscriptionId String?
  shippingAddress  Json
  status           String        @default("active")
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  subscriptions    subscriptions @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
}

model magazines {
  id            String   @id
  title         String
  slug          String   @unique
  publishedText String
  description   String?
  pdfUrl        String
  coverImageUrl String?
  fileSize      Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([slug])
}

model media {
  id         String   @id
  filename   String
  url        String
  mimeType   String
  size       Int
  width      Int?
  height     Int?
  alt        String?
  uploadedBy String
  createdAt  DateTime @default(now())
  caption    String?
}

model newsletter_subscribers {
  id             String           @id
  email          String           @unique
  status         SubscriberStatus @default(ACTIVE)
  subscribedAt   DateTime         @default(now())
  unsubscribedAt DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime

  @@index([email])
  @@index([status])
}

model order_items {
  id          String   @id
  orderId     String
  productId   String
  productName String
  quantity    Int
  price       Decimal  @db.Decimal(10, 2)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  orders      orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products    products @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model orders {
  id                  String            @id
  orderNumber         String            @unique
  memberId            String            // Changed from userId to memberId
  userName            String
  userEmail           String
  total               Decimal           @db.Decimal(10, 2)
  subtotal            Decimal           @db.Decimal(10, 2)
  tax                 Decimal           @default(0) @db.Decimal(10, 2)
  shipping            Decimal           @default(0) @db.Decimal(10, 2)
  discount            Decimal           @default(0) @db.Decimal(10, 2)
  status              OrderStatus       @default(PENDING)
  paymentMethod       String
  paymentId           String?
  shippingAddress     String?
  billingAddress      String?
  notes               String?
  orderSource         String            @default("InHouse")
  woocommerceOrderId  String?
  fulfillmentStatus   String            @default("UNFULFILLED")
  fulfilledAt         DateTime?
  fulfilledBy         String?
  trackingNumber      String?
  trackingCarrier     String?
  trackingUrl         String?
  shippedDate         DateTime?
  deliveredDate       DateTime?
  packingSlipPrinted  Boolean           @default(false)
  internalNotes       String?
  customerNotes       String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  order_items         order_items[]
  member              members           @relation(fields: [memberId], references: [id], onDelete: Cascade)
  refund_disputes     refund_disputes[]

  @@index([createdAt])
  @@index([orderNumber])
  @@index([status])
  @@index([memberId])
  @@index([fulfillmentStatus])
  @@index([orderSource])
  @@index([woocommerceOrderId])
}

model page_views {
  id           String   @id
  userId       String?
  sessionId    String?
  articleId    String
  articleTitle String
  articleUrl   String
  viewedAt     DateTime @default(now())
  ipAddress    String?
  userAgent    String?

  @@index([articleId])
  @@index([sessionId])
  @@index([userId])
  @@index([viewedAt])
}

model pay_links {
  id               String        @id
  userId           String
  title            String
  description      String?
  amount           Decimal       @db.Decimal(10, 2)
  currency         String        @default("USD")
  slug             String        @unique
  stripePriceId    String?
  stripeProductId  String?
  status           PayLinkStatus @default(ACTIVE)
  expiresAt        DateTime?
  maxUses          Int?
  currentUses      Int           @default(0)
  requiresShipping Boolean       @default(false)
  customFields     Json?
  metadata         Json?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime
  users            users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([slug])
  @@index([status])
  @@index([userId])
}

model pages {
  id                String     @id
  title             String
  slug              String     @unique
  content           String
  status            PostStatus @default(DRAFT)
  publishedAt       DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  seoTitle          String?
  seoDescription    String?
  featuredImage     String?
  featuredImageAlt  String?
  wordpressId       Int?       @unique
  template          String?
  parentId          String?
  order             Int        @default(0)

  @@index([slug])
  @@index([wordpressId])
}

model paywall_config {
  id                 String   @id
  freeArticleLimit   Int      @default(3)
  resetPeriodDays    Int      @default(30)
  enablePaywall      Boolean  @default(true)
  bypassedCategories String[]
  bypassedArticles   String[]
  popupTitle         String   @default("You've reached your free article limit")
  popupMessage       String
  ctaButtonText      String   @default("Subscribe Now")
  createdAt          DateTime @default(now())
  updatedAt          DateTime
}

model podcasts {
  id          String     @id
  title       String
  slug        String     @unique
  description String?
  audioUrl    String
  thumbnail   String?
  duration    Int?
  status      PostStatus @default(DRAFT)
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  wordpressId Int?       @unique

  @@index([slug])
  @@index([wordpressId])
}

model posts {
  id                   String           @id
  title                String
  slug                 String           @unique
  content              String
  excerpt              String?
  featuredImage        String?
  featuredImageAlt     String?
  featuredImageCaption String?
  status               PostStatus       @default(DRAFT)
  authorId             String
  publishedAt          DateTime?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  seoTitle             String?
  seoDescription       String?
  metaKeywords         String?
  canonicalUrl         String?
  readTime             Int?
  views                Int              @default(0)
  customExcerpt        Boolean          @default(false)
  wordpressId          Int?             @unique
  wordpressSlug        String?
  wordpressAuthor      String?
  users                users            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  categories           categories[]     @relation("PostCategories")
  tags                 tags[]           @relation("PostTags")
  post_revisions       post_revisions[]

  @@index([publishedAt])
  @@index([slug])
  @@index([status])
  @@index([wordpressId])
}

model post_revisions {
  id               String   @id
  postId           String
  title            String
  content          String
  excerpt          String?
  featuredImage    String?
  featuredImageAlt String?
  status           String
  seoTitle         String?
  seoDescription   String?
  authorId         String
  authorName       String
  changeNote       String?
  createdAt        DateTime @default(now())
  posts            posts    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([createdAt])
}

model products {
  id          String          @id
  name        String
  slug        String          @unique
  description String?
  price       Float
  salePrice   Float?
  sku         String?         @unique
  imageUrl    String?
  status      ProductStatus   @default(ACTIVE)
  featured    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime
  category    ProductCategory
  images      String[]
  metadata    String?
  shortDesc   String?
  stock       Int             @default(0)
  subcategory String?
  order_items order_items[]

  @@index([category])
  @@index([featured])
  @@index([slug])
}

model reading_progress {
  id           String   @id
  userId       String
  articleId    String
  articleTitle String
  articleUrl   String
  progress     Int
  completed    Boolean  @default(false)
  lastReadAt   DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, articleId])
  @@index([completed])
  @@index([userId])
}

model seo_settings {
  id                         String   @id
  siteTitle                  String   @default("SUCCESS Magazine")
  siteDescription            String   @default("Your Guide to Personal and Professional Growth")
  siteKeywords               String   @default("success, business, entrepreneurship, leadership, personal development")
  ogImage                    String   @default("https://www.success.com/og-image.jpg")
  ogType                     String   @default("website")
  twitterHandle              String   @default("@successmagazine")
  twitterCardType            String   @default("summary_large_image")
  googleAnalyticsId          String?
  googleSearchConsoleCode    String?
  bingWebmasterCode          String?
  facebookDomainVerification String?
  sitemapUrl                 String   @default("/api/sitemap.xml")
  robotsTxt                  String   @default("User-agent: *\nAllow: /")
  canonicalUrl               String?
  hreflangTags               String?
  schemaOrgMarkup            String?
  headerScripts              String?
  footerScripts              String?
  faviconUrl                 String?
  appleTouchIconUrl          String?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime
}

model sessions {
  id           String   @id
  userId       String
  sessionToken String   @unique
  expires      DateTime
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionToken])
  @@index([userId])
}

model site_settings {
  id                     String   @id
  siteName               String   @default("SUCCESS Magazine")
  siteDescription        String?
  siteUrl                String?
  adminEmail             String?
  facebookUrl            String?
  twitterUrl             String?
  instagramUrl           String?
  linkedinUrl            String?
  youtubeUrl             String?
  wordpressApiUrl        String?
  wordpressApiKey        String?
  defaultMetaTitle       String?
  defaultMetaDescription String?
  googleAnalyticsId      String?
  facebookPixelId        String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime
}

model subscriptions {
  id                         String                  @id
  memberId                   String                  // Changed from userId to memberId
  stripeCustomerId           String?
  stripeSubscriptionId       String?                 @unique
  stripePriceId              String?
  paykickstartCustomerId     String?
  paykickstartSubscriptionId String?                 @unique
  provider                   String                  @default("stripe")
  currentPeriodStart         DateTime?
  currentPeriodEnd           DateTime?
  cancelAtPeriodEnd          Boolean                 @default(false)
  createdAt                  DateTime                @default(now())
  updatedAt                  DateTime
  billingCycle               String?
  tier                       String?
  status                     String                  @default("inactive")
  magazine_subscriptions     magazine_subscriptions?
  member                     members                 @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([stripeCustomerId])
  @@index([paykickstartCustomerId])
  @@index([paykickstartSubscriptionId])
  @@index([provider])
  @@index([status])
}

model tags {
  id          String   @id
  name        String
  slug        String   @unique
  wordpressId Int?     @unique
  description String?
  postCount   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  posts       posts[]  @relation("PostTags")

  @@index([slug])
  @@index([wordpressId])
}

model url_redirects {
  id         String   @id
  oldUrl     String   @unique
  newUrl     String
  statusCode Int      @default(301)
  hits       Int      @default(0)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([isActive])
  @@index([oldUrl])
}

model user_activities {
  id           String       @id
  userId       String
  activityType ActivityType
  title        String
  description  String?
  metadata     String?
  createdAt    DateTime     @default(now())
  users        users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([activityType])
  @@index([createdAt])
  @@index([userId])
}

// Platform Access - Admin, Staff, Editors
model users {
  id                        String               @id
  name                      String
  email                     String               @unique
  password                  String
  role                      UserRole             @default(EDITOR)
  bio                       String?
  avatar                    String?
  createdAt                 DateTime             @default(now())
  updatedAt                 DateTime             @updatedAt
  lastLoginAt               DateTime?
  emailVerified             Boolean              @default(false)
  emailVerificationToken    String?
  resetToken                String?
  resetTokenExpiry          DateTime?
  hasChangedDefaultPassword Boolean              @default(false)
  invitedBy                 String?

  // Trial fields
  trialEndsAt               DateTime?
  linkedMemberId            String?
  inviteCode                String?
  isActive                  Boolean              @default(true)

  // WordPress author fields (for content creators)
  wordpressId               Int?                 @unique
  socialTwitter             String?
  socialLinkedin            String?
  socialFacebook            String?
  website                   String?
  jobTitle                  String?
  authorPageSlug            String?              @unique
  onboardingCompleted       Boolean              @default(false)
  interests                 String[]

  // Department assignment for staff users
  primaryDepartment         Department?

  // Link to Member if this user is ALSO a customer
  memberId                  String?              @unique
  member                    members?             @relation("UserMemberLink", fields: [memberId], references: [id], onDelete: SetNull)

  activity_logs             activity_logs[]
  bookmarks                 bookmarks[]
  bulk_actions              bulk_actions[]
  editorial_calendar        editorial_calendar[]
  posts                     posts[]
  reading_progress          reading_progress[]
  sessions                  sessions[]
  user_activities           user_activities[]
  pay_links                 pay_links[]
  assigned_projects         projects[]           @relation("AssignedProjects")
  created_projects          projects[]           @relation("CreatedProjects")
  course_enrollments        course_enrollments[]
  staff_departments         staff_departments[]
  refunds                   refunds[]            @relation("RefundsToUsers")
  disputes                  disputes[]           @relation("DisputesToUsers")

  @@index([email])
  @@index([inviteCode])
  @@index([wordpressId])
  @@index([authorPageSlug])
  @@index([role])
  @@index([memberId])
}

// Commerce & Customers - People who have purchased/subscribed
model members {
  id                        String              @id
  firstName                 String
  lastName                  String
  email                     String              @unique
  phone                     String?
  joinDate                  DateTime            @default(now())

  // Customer-specific roles (based on purchases/subscriptions)
  membershipTier            MembershipTier      @default(Free)
  membershipStatus          MemberStatus        @default(Active)

  // Trial fields
  trialEndsAt               DateTime?
  trialStartedAt            DateTime?

  // Platform user link (if they ALSO have admin/staff access)
  platformUser              users?              @relation("UserMemberLink")

  // Customer metrics
  lastLoginDate             DateTime?
  totalSpent                Decimal             @db.Decimal(10, 2) @default(0)
  lifetimeValue             Decimal             @db.Decimal(10, 2) @default(0)
  engagementScore           Int                 @default(0)
  tags                      String[]
  billingAddress            Json?
  shippingAddress           Json?
  communicationPreferences  Json?
  assignedCSRep             String?
  priorityLevel             PriorityLevel       @default(Standard)
  internalNotes             String?             @db.Text

  // Payment provider IDs
  stripeCustomerId          String?             @unique
  paykickstartCustomerId    String?             @unique
  woocommerceCustomerId     Int?                @unique

  lastContactDate           DateTime?
  createdAt                 DateTime            @default(now())
  updatedAt                 DateTime            @updatedAt

  transactions              transactions[]
  subscriptions             subscriptions[]
  subscribers               subscribers[]
  orders                    orders[]
  refund_disputes           refund_disputes[]

  @@index([email])
  @@index([membershipStatus])
  @@index([membershipTier])
  @@index([stripeCustomerId])
  @@index([paykickstartCustomerId])
  @@index([totalSpent])
}

// Transaction history for members
model transactions {
  id              String   @id @default(uuid())
  memberId        String
  amount          Decimal  @db.Decimal(10, 2)
  currency        String   @default("USD")
  status          String   // succeeded, failed, pending, refunded
  type            String   // subscription, one-time, refund
  description     String?
  paymentMethod   String?  // card, paypal, etc.
  provider        String   // stripe, paykickstart, woocommerce
  providerTxnId   String?  // Provider's transaction ID
  metadata        Json?
  createdAt       DateTime @default(now())

  member          members  @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
  @@index([status])
  @@index([createdAt])
  @@index([provider])
}

// Newsletter subscribers (separate from members)
model subscribers {
  id              String           @id @default(uuid())
  email           String           @unique
  firstName       String?
  lastName        String?
  type            SubscriberType   @default(EmailNewsletter)
  recipientType   RecipientType    @default(Customer)
  isComplimentary Boolean          @default(false)
  status          SubscriberStatus @default(ACTIVE)
  source          String?          // website, import, api
  subscribedAt    DateTime         @default(now())
  unsubscribedAt  DateTime?
  memberId        String?          // Link to member if they're also a customer
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  member          members?         @relation(fields: [memberId], references: [id], onDelete: SetNull)

  @@index([email])
  @@index([status])
  @@index([type])
  @@index([recipientType])
  @@index([isComplimentary])
  @@index([memberId])
}

// Refund & dispute tracking
model refund_disputes {
  id              String          @id @default(uuid())
  memberId        String
  orderId         String?
  transactionId   String?
  type            DisputeType
  status          DisputeStatus   @default(OPEN)
  amount          Decimal         @db.Decimal(10, 2)
  reason          String?
  description     String?         @db.Text
  resolution      String?         @db.Text
  assignedTo      String?         // Staff user ID
  priority        Priority        @default(MEDIUM)
  createdAt       DateTime        @default(now())
  resolvedAt      DateTime?
  updatedAt       DateTime        @updatedAt

  member          members         @relation(fields: [memberId], references: [id], onDelete: Cascade)
  order           orders?         @relation(fields: [orderId], references: [id], onDelete: SetNull)

  @@index([memberId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
}

model refunds {
  id             String    @id
  userId         String
  paymentId      String
  originalAmount Decimal   @db.Decimal(10, 2)
  amount         Decimal   @db.Decimal(10, 2)
  reason         String
  notes          String?   @db.Text
  status         String    @default("pending")
  processedBy    String
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  users          users     @relation("RefundsToUsers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model disputes {
  id               String    @id
  userId           String
  chargeId         String
  amount           Decimal   @db.Decimal(10, 2)
  reason           String
  status           String    @default("needs_response")
  dueDate          DateTime?
  notes            String?   @db.Text
  stripeDisputeId  String?
  createdBy        String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  users            users     @relation("DisputesToUsers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model dispute_status_history {
  id         String   @id
  disputeId  String
  status     String
  changedBy  String
  notes      String?  @db.Text
  createdAt  DateTime @default(now())

  @@index([disputeId])
  @@index([createdAt])
}

model invite_codes {
  id        String    @id
  code      String    @unique
  email     String?
  role      UserRole  @default(EDITOR)
  createdBy String
  usedBy    String?
  usedAt    DateTime?
  expiresAt DateTime
  maxUses   Int       @default(1)
  uses      Int       @default(0)
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())

  @@index([code])
  @@index([isActive])
}

model videos {
  id               String     @id
  title            String
  slug             String     @unique
  description      String?
  videoUrl         String
  thumbnail        String?
  duration         Int?
  status           PostStatus @default(DRAFT)
  publishedAt      DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  seoTitle         String?
  seoDescription   String?
  featuredImage    String?
  featuredImageAlt String?
  wordpressId      Int?       @unique

  @@index([slug])
  @@index([wordpressId])
}

model press_releases {
  id             String     @id @default(uuid())
  title          String
  slug           String     @unique
  content        String
  excerpt        String?
  featuredImage  String?
  status         PostStatus @default(DRAFT)
  publishedAt    DateTime?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  seoTitle       String?
  seoDescription String?
  wordpressId    Int?       @unique

  @@index([slug])
  @@index([publishedAt])
  @@index([wordpressId])
}

model wordpress_migration {
  id           String   @id @default(uuid())
  contentType  String
  wordpressId  Int
  localId      String
  migratedAt   DateTime @default(now())
  status       String   @default("completed")
  errorMessage String?

  @@unique([contentType, wordpressId])
  @@index([contentType])
  @@index([status])
}

model projects {
  id           String        @id @default(uuid())
  title        String
  description  String?
  status       ProjectStatus @default(BACKLOG)
  assignedToId String?
  priority     Priority      @default(MEDIUM)
  dueDate      DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  createdBy    String
  order        Int           @default(0)
  tags         String[]
  notes        String?
  users        users?        @relation("AssignedProjects", fields: [assignedToId], references: [id], onDelete: SetNull)
  creator      users         @relation("CreatedProjects", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([assignedToId])
  @@index([createdBy])
  @@index([priority])
  @@index([dueDate])
}

enum ActivityType {
  ARTICLE_READ
  ARTICLE_BOOKMARKED
  VIDEO_WATCHED
  PODCAST_LISTENED
  ACHIEVEMENT_UNLOCKED
  SUBSCRIPTION_STARTED
}

enum BillingCycle {
  MONTHLY
  ANNUAL
}

enum BulkStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  PAUSED
}

enum CommentStatus {
  PENDING
  APPROVED
  SPAM
  TRASH
}

enum ContactStatus {
  ACTIVE
  UNSUBSCRIBED
  BOUNCED
  SPAM
}

enum ContentType {
  ARTICLE
  VIDEO
  PODCAST
  MAGAZINE
  PAGE
  NEWSLETTER
}

enum EditorialStatus {
  IDEA
  ASSIGNED
  IN_PROGRESS
  DRAFT
  IN_REVIEW
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum MembershipTier {
  Free              // Free account, no purchases
  Customer          // Made a purchase
  SUCCESSPlus       // Active SUCCESS+ subscription
  VIP               // VIP tier
  Enterprise        // Enterprise tier
}

enum MemberStatus {
  Active
  Inactive
  Suspended
  Cancelled
}

enum PriorityLevel {
  Standard
  High
  VIP
  Enterprise
}

enum DisputeType {
  REFUND
  CHARGEBACK
  DISPUTE
  CANCELLATION
}

enum DisputeStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
  ESCALATED
}

// ============================================
// ENTERPRISE ADMIN FEATURES
// ============================================

// Audit Logging - Track every action for compliance
model audit_logs {
  id          String   @id @default(uuid())
  userId      String?
  userEmail   String
  userName    String?
  action      String   // "user.created", "transaction.refunded", "content.published"
  entityType  String   // "User", "Transaction", "Member", "Post"
  entityId    String?
  changes     Json?    // {before: {...}, after: {...}}
  ipAddress   String?
  userAgent   String?
  requestUrl  String?
  method      String?  // GET, POST, PUT, DELETE
  statusCode  Int?
  duration    Int?     // milliseconds
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([userEmail])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
}

// System Alerts & Notifications
model system_alerts {
  id           String      @id @default(uuid())
  type         AlertType   // Error, Warning, Info, Critical
  category     AlertCategory
  title        String
  message      String      @db.Text
  severity     Int         // 1-5 (5 = critical)
  isRead       Boolean     @default(false)
  isResolved   Boolean     @default(false)
  assignedTo   String?
  assignedToEmail String?
  resolvedBy   String?
  metadata     Json?
  stackTrace   String?     @db.Text
  errorCount   Int         @default(1)
  firstSeen    DateTime    @default(now())
  lastSeen     DateTime    @default(now())
  createdAt    DateTime    @default(now())
  resolvedAt   DateTime?

  @@index([type])
  @@index([category])
  @@index([isRead])
  @@index([isResolved])
  @@index([severity])
  @@index([createdAt])
  @@index([assignedTo])
}

// User Notifications (in-app)
model notifications {
  id          String             @id @default(uuid())
  userId      String
  type        NotificationType
  title       String
  message     String             @db.Text
  actionUrl   String?
  icon        String?
  isRead      Boolean            @default(false)
  priority    NotificationPriority @default(NORMAL)
  metadata    Json?
  expiresAt   DateTime?
  createdAt   DateTime           @default(now())
  readAt      DateTime?

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@index([priority])
}

// Workflow Automation Engine
model workflows {
  id          String        @id @default(uuid())
  name        String
  description String?       @db.Text
  isActive    Boolean       @default(true)
  trigger     Json          // {type: "payment.received", conditions: {...}}
  actions     Json[]        // [{type: "send.email", config: {...}}]
  createdBy   String
  createdByEmail String
  lastRun     DateTime?
  nextRun     DateTime?
  runCount    Int           @default(0)
  successCount Int          @default(0)
  failureCount Int          @default(0)
  lastError   String?       @db.Text
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  executions  workflow_executions[]

  @@index([isActive])
  @@index([createdBy])
}

model workflow_executions {
  id          String          @id @default(uuid())
  workflowId  String
  status      ExecutionStatus
  triggeredBy Json            // event data
  results     Json?           // action results
  error       String?         @db.Text
  duration    Int?            // milliseconds
  startedAt   DateTime        @default(now())
  completedAt DateTime?
  workflow    workflows       @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([workflowId])
  @@index([status])
  @@index([startedAt])
}

// Webhook Delivery Logs
model webhook_logs {
  id            String          @id @default(uuid())
  provider      String          // Stripe, PayKickstart, WooCommerce, Custom
  eventType     String
  eventId       String?         // Provider's event ID
  payload       Json
  headers       Json?
  status        WebhookStatus
  attempts      Int             @default(0)
  maxAttempts   Int             @default(3)
  lastAttempt   DateTime?
  nextAttempt   DateTime?
  errorMessage  String?         @db.Text
  responseCode  Int?
  responseBody  String?         @db.Text
  processedAt   DateTime?
  createdAt     DateTime        @default(now())

  @@index([provider])
  @@index([eventType])
  @@index([status])
  @@index([createdAt])
}

// Scheduled Tasks / Cron Jobs
model scheduled_tasks {
  id            String      @id @default(uuid())
  name          String
  description   String?     @db.Text
  schedule      String      // cron expression (e.g., "0 0 * * *")
  taskType      String      // "email.digest", "data.sync", "cleanup"
  config        Json?
  isActive      Boolean     @default(true)
  lastRun       DateTime?
  nextRun       DateTime?
  runCount      Int         @default(0)
  successCount  Int         @default(0)
  failureCount  Int         @default(0)
  lastStatus    String?     // success, failed, running
  lastError     String?     @db.Text
  lastDuration  Int?        // milliseconds
  createdBy     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([isActive])
  @@index([taskType])
  @@index([nextRun])
}

// Custom Reports
model custom_reports {
  id          String   @id @default(uuid())
  name        String
  description String?  @db.Text
  createdBy   String
  createdByEmail String
  dataSource  String   // "transactions", "members", "content"
  config      Json     // {filters, grouping, charts, columns}
  chartType   String?  // bar, line, pie, table
  isPublic    Boolean  @default(false)
  isFavorite  Boolean  @default(false)
  schedule    String?  // cron for scheduled reports
  lastRun     DateTime?
  runCount    Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([createdBy])
  @@index([dataSource])
  @@index([isPublic])
}

// API Keys Management
model api_keys {
  id          String      @id @default(uuid())
  name        String
  key         String      @unique  // Hashed API key
  keyPreview  String      // Last 4 characters for display
  userId      String
  userEmail   String
  scopes      String[]    // ["read:members", "write:transactions"]
  isActive    Boolean     @default(true)
  expiresAt   DateTime?
  lastUsedAt  DateTime?
  usageCount  Int         @default(0)
  rateLimit   Int         @default(1000)  // requests per hour
  ipWhitelist String[]    @default([])
  metadata    Json?
  createdAt   DateTime    @default(now())
  revokedAt   DateTime?

  @@index([userId])
  @@index([isActive])
}

// Security Sessions
model security_sessions {
  id          String   @id @default(uuid())
  userId      String
  userEmail   String
  deviceInfo  Json     // {browser, os, device}
  ipAddress   String
  location    Json?    // {country, city, lat, lon}
  isActive    Boolean  @default(true)
  isTrusted   Boolean  @default(false)
  lastActivity DateTime @default(now())
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  revokedAt   DateTime?

  @@index([userId])
  @@index([isActive])
  @@index([expiresAt])
}

// Failed Login Attempts (Security)
model login_attempts {
  id          String   @id @default(uuid())
  email       String
  ipAddress   String
  userAgent   String?
  success     Boolean
  failReason  String?
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([email])
  @@index([ipAddress])
  @@index([success])
  @@index([createdAt])
}

// GDPR Data Requests
model gdpr_requests {
  id          String       @id @default(uuid())
  userId      String?
  email       String
  requestType GDPRRequestType
  status      GDPRStatus   @default(PENDING)
  requestedBy String?      // User ID who made request
  processedBy String?      // Admin who processed
  dataExport  Json?        // Exported data
  deletedData Json?        // What was deleted
  notes       String?      @db.Text
  createdAt   DateTime     @default(now())
  processedAt DateTime?
  completedAt DateTime?

  @@index([email])
  @@index([requestType])
  @@index([status])
  @@index([createdAt])
}

// System Metrics (Performance Monitoring)
model system_metrics {
  id          String   @id @default(uuid())
  metricType  String   // cpu, memory, disk, db_connections, api_latency
  value       Float
  unit        String   // percent, mb, ms, count
  metadata    Json?
  timestamp   DateTime @default(now())

  @@index([metricType])
  @@index([timestamp])
}

// Error Tracking
model error_logs {
  id          String   @id @default(uuid())
  errorType   String   // TypeError, ValidationError, APIError
  message     String   @db.Text
  stackTrace  String?  @db.Text
  userId      String?
  userEmail   String?
  url         String?
  method      String?
  statusCode  Int?
  environment String   @default("production")
  severity    String   // low, medium, high, critical
  isResolved  Boolean  @default(false)
  resolvedBy  String?
  resolvedAt  DateTime?
  occurrences Int      @default(1)
  firstSeen   DateTime @default(now())
  lastSeen    DateTime @default(now())
  metadata    Json?

  @@index([errorType])
  @@index([severity])
  @@index([isResolved])
  @@index([firstSeen])
  @@index([userId])
}

// Database Backups
model database_backups {
  id          String        @id @default(uuid())
  filename    String
  fileSize    BigInt        // bytes
  backupType  BackupType
  status      BackupStatus
  s3Url       String?
  localPath   String?
  checksum    String?
  triggeredBy String?
  error       String?       @db.Text
  startedAt   DateTime      @default(now())
  completedAt DateTime?
  expiresAt   DateTime?

  @@index([backupType])
  @@index([status])
  @@index([startedAt])
}

// Email Deliverability Tracking
model email_deliverability {
  id              String   @id @default(uuid())
  provider        String   // SendGrid, Mailchimp, AWS SES
  campaignId      String?
  emailId         String?
  recipientEmail  String
  subject         String?
  status          EmailDeliveryStatus
  bounceType      String?  // hard, soft, transient
  bounceReason    String?  @db.Text
  spamReport      Boolean  @default(false)
  opened          Boolean  @default(false)
  clicked         Boolean  @default(false)
  openedAt        DateTime?
  clickedAt       DateTime?
  sentAt          DateTime  @default(now())
  deliveredAt     DateTime?
  bouncedAt       DateTime?

  @@index([recipientEmail])
  @@index([status])
  @@index([provider])
  @@index([sentAt])
}

// Content Approval Workflow
model content_approvals {
  id          String          @id @default(uuid())
  contentType String          // post, page, video, podcast
  contentId   String
  contentTitle String
  submittedBy String
  submitterEmail String
  currentStep Int             @default(1)
  totalSteps  Int             @default(1)
  status      ApprovalStatus  @default(PENDING)
  approvers   Json[]          // [{userId, email, step, approved, comments}]
  metadata    Json?
  submittedAt DateTime        @default(now())
  approvedAt  DateTime?
  rejectedAt  DateTime?

  @@index([contentType])
  @@index([contentId])
  @@index([status])
  @@index([submittedBy])
}

// Content Version History
model content_versions {
  id          String   @id @default(uuid())
  contentType String
  contentId   String
  version     Int
  title       String
  content     String   @db.Text
  excerpt     String?  @db.Text
  metadata    Json?
  changedBy   String
  changerEmail String
  changeNote  String?  @db.Text
  diff        Json?    // Calculated differences
  createdAt   DateTime @default(now())

  @@unique([contentType, contentId, version])
  @@index([contentType])
  @@index([contentId])
  @@index([createdAt])
}

// SUCCESS Labs Analytics
model success_labs_sessions {
  id              String   @id @default(uuid())
  userId          String?
  memberId        String?
  sessionType     String   // victor_ai, notebooklm, tool_usage
  toolName        String?  // Which SUCCESS Lab tool
  duration        Int?     // seconds
  messagesCount   Int      @default(0)
  satisfaction    Int?     // 1-5 rating
  outcome         String?  // completed, abandoned, error
  metadata        Json?
  startedAt       DateTime @default(now())
  endedAt         DateTime?

  @@index([userId])
  @@index([memberId])
  @@index([sessionType])
  @@index([toolName])
  @@index([startedAt])
}

// KPI Tracking
model kpi_metrics {
  id          String   @id @default(uuid())
  name        String
  category    String   // revenue, growth, engagement, retention
  value       Float
  target      Float?
  unit        String   // dollars, percent, count
  period      String   // daily, weekly, monthly, quarterly
  periodStart DateTime
  periodEnd   DateTime
  metadata    Json?
  calculatedAt DateTime @default(now())

  @@index([name])
  @@index([category])
  @@index([periodStart])
}

// Enums for Enterprise Features
enum AlertType {
  Error
  Warning
  Info
  Critical
  Success
}

enum AlertCategory {
  Security
  Payment
  System
  Content
  CustomerService
  Integration
  Performance
  Compliance
}

enum NotificationType {
  TASK_ASSIGNED
  MENTION
  PAYMENT_FAILED
  SLA_BREACH
  SYSTEM_ERROR
  APPROVAL_NEEDED
  COMMENT_REPLY
  REPORT_READY
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum WebhookStatus {
  Success
  Failed
  Pending
  Retrying
  MaxAttemptsReached
}

enum ExecutionStatus {
  RUNNING
  SUCCESS
  FAILED
  CANCELLED
}

enum GDPRRequestType {
  DATA_EXPORT
  DATA_DELETION
  DATA_CORRECTION
  CONSENT_WITHDRAWAL
}

enum GDPRStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
}

enum BackupType {
  FULL
  INCREMENTAL
  MANUAL
  SCHEDULED
}

enum BackupStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum EmailDeliveryStatus {
  SENT
  DELIVERED
  BOUNCED
  DEFERRED
  SPAM
  DROPPED
}

enum ApprovalStatus {
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum OrderStatus {
  PENDING
  PROCESSING
  COMPLETED
  SHIPPED
  CANCELED
  REFUNDED
  FAILED
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProductCategory {
  BOOKS
  COURSES
  MERCHANDISE
  MAGAZINES
  BUNDLES
  MEMBERSHIPS
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  OUT_OF_STOCK
  ARCHIVED
  ACTIVE
  DISCONTINUED
}

enum SubscriberStatus {
  ACTIVE
  UNSUBSCRIBED
  BOUNCED
}

enum SubscriberType {
  MagazinePrint
  MagazineDigital
  SUCCESSPlus
  CoachingProgram
  EmailNewsletter
  All
}

enum RecipientType {
  Customer
  Agent
  Staff
  Partner
  Press
  Other
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  PAST_DUE
  CANCELED
  TRIALING
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  EDITOR
  AUTHOR
}

enum Department {
  SUPER_ADMIN
  CUSTOMER_SERVICE
  EDITORIAL
  SUCCESS_PLUS
  DEV
  MARKETING
  COACHING
}

enum PayLinkStatus {
  ACTIVE
  INACTIVE
  EXPIRED
  ARCHIVED
}

enum ProjectStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  REVIEW
  DONE
}

model courses {
  id              String               @id @default(uuid())
  title           String
  slug            String               @unique
  description     String?
  thumbnail       String?
  instructorName  String?
  instructorBio   String?
  instructorImage String?
  duration        Int? // in minutes
  level           CourseLevel          @default(BEGINNER)
  category        String?
  isPremium       Boolean              @default(true)
  isPublished     Boolean              @default(false)
  order           Int                  @default(0)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  modules         course_modules[]
  enrollments     course_enrollments[]

  @@index([slug])
  @@index([isPremium])
  @@index([isPublished])
}

model course_modules {
  id          String           @id @default(uuid())
  courseId    String
  title       String
  description String?
  order       Int
  duration    Int? // in minutes
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  course      courses          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons     course_lessons[]

  @@index([courseId])
  @@index([order])
}

model course_lessons {
  id          String            @id @default(uuid())
  moduleId    String
  title       String
  description String?
  videoUrl    String?
  content     String?
  duration    Int? // in minutes
  order       Int
  isFree      Boolean           @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  module      course_modules    @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  progress    lesson_progress[]

  @@index([moduleId])
  @@index([order])
}

model course_enrollments {
  id             String    @id @default(uuid())
  userId         String
  courseId       String
  progress       Int       @default(0) // percentage
  completedAt    DateTime?
  lastAccessedAt DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  users          users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course         courses   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
}

model lesson_progress {
  id            String         @id @default(uuid())
  userId        String
  lessonId      String
  completed     Boolean        @default(false)
  progress      Int            @default(0) // percentage for video
  watchTime     Int            @default(0) // in seconds
  lastWatchedAt DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  lesson        course_lessons @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
  @@index([userId])
  @@index([lessonId])
}

model resources {
  id          String           @id @default(uuid())
  title       String
  description String?
  category    ResourceCategory
  fileUrl     String
  fileType    String
  fileSize    Int?
  thumbnail   String?
  isPremium   Boolean          @default(true)
  downloads   Int              @default(0)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([category])
  @@index([isPremium])
}

model success_labs {
  id          String   @id @default(uuid())
  title       String
  slug        String   @unique
  description String?
  category    String?
  thumbnail   String?
  toolUrl     String
  isPremium   Boolean  @default(true)
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([isPremium])
  @@index([isActive])
}

model events {
  id               String                @id @default(uuid())
  title            String
  slug             String                @unique
  description      String?
  eventType        EventType             @default(WEBINAR)
  startDateTime    DateTime
  endDateTime      DateTime?
  timezone         String                @default("America/New_York")
  location         String? // For virtual events, this could be the meeting link
  thumbnail        String?
  hostName         String?
  hostBio          String?
  hostImage        String?
  isPremium        Boolean               @default(true)
  maxAttendees     Int?
  currentAttendees Int                   @default(0)
  isPublished      Boolean               @default(false)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  registrations    event_registrations[]

  @@index([slug])
  @@index([startDateTime])
  @@index([isPremium])
  @@index([isPublished])
}

model event_registrations {
  id           String                  @id @default(uuid())
  userId       String
  eventId      String
  status       EventRegistrationStatus @default(REGISTERED)
  attended     Boolean                 @default(false)
  registeredAt DateTime                @default(now())
  canceledAt   DateTime?
  event        events                  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([userId])
  @@index([eventId])
  @@index([status])
}

model magazine_progress {
  id          String   @id @default(uuid())
  userId      String
  magazineId  String
  currentPage Int      @default(1)
  totalPages  Int
  completed   Boolean  @default(false)
  lastReadAt  DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, magazineId])
  @@index([userId])
  @@index([magazineId])
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  ALL_LEVELS
}

enum ResourceCategory {
  TEMPLATES
  GUIDES
  WORKSHEETS
  EBOOKS
  TOOLS
  CHECKLISTS
}

enum EventType {
  WEBINAR
  WORKSHOP
  QA_SESSION
  NETWORKING
  MASTERCLASS
  CONFERENCE
}

enum EventRegistrationStatus {
  REGISTERED
  WAITLISTED
  CANCELED
  ATTENDED
}

model staff_departments {
  id         String     @id @default(uuid())
  userId     String
  department Department
  assignedBy String // User ID of Super Admin who assigned
  assignedAt DateTime   @default(now())
  user       users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, department])
  @@index([userId])
  @@index([department])
}

// Page Permissions System
model page_permissions {
  id          String   @id @default(uuid())
  pagePath    String // e.g., "/admin/posts", "/admin/media", "/admin/analytics"
  displayName String // Human-readable name for the page
  description String? // Description of what this page does
  category    String // e.g., "Content", "User Management", "Analytics", "System"
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  role_permissions       role_permissions[]
  department_permissions department_permissions[]

  @@unique([pagePath])
  @@index([category])
  @@index([isActive])
}

// Role-based permissions (e.g., all EDITORs can access /admin/posts)
model role_permissions {
  id        String           @id @default(uuid())
  pageId    String
  role      UserRole
  canAccess Boolean          @default(true)
  canCreate Boolean          @default(false)
  canEdit   Boolean          @default(false)
  canDelete Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  page      page_permissions @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, role])
  @@index([role])
}

// Department-based permissions (e.g., EDITORIAL department can access /admin/editorial)
model department_permissions {
  id         String           @id @default(uuid())
  pageId     String
  department Department
  canAccess  Boolean          @default(true)
  canCreate  Boolean          @default(false)
  canEdit    Boolean          @default(false)
  canDelete  Boolean          @default(false)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  page       page_permissions @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, department])
  @@index([department])
}

// Note: This project already has existing orders, subscription-related tables.
// The Sales & CS admin section will use and extend the existing tables.
// See existing: orders, subscriptions, magazine_subscriptions, email_subscribers, users

// ============================================
// DEVOPS & SYSTEM MANAGEMENT
// ============================================

// Feature Flags for toggling features on/off
model feature_flags {
  id            String   @id @default(uuid())
  name          String   @unique
  description   String
  enabled       Boolean  @default(false)
  affectedUsers Int      @default(0)
  lastModifiedBy String?
  lastModifiedAt DateTime @updatedAt
  createdAt     DateTime @default(now())

  @@index([enabled])
}

// Deployment History
model deployments {
  id          String           @id @default(uuid())
  version     String
  branch      String
  commit      String
  deployedBy  String
  deployedAt  DateTime         @default(now())
  status      DeploymentStatus @default(IN_PROGRESS)
  environment String           @default("production")
  buildTime   Int?             // seconds
  errorMessage String?         @db.Text

  @@index([deployedAt])
  @@index([status])
  @@index([environment])
}

enum DeploymentStatus {
  IN_PROGRESS
  SUCCESS
  FAILED
}

// System Settings for cache, maintenance mode, etc.
model system_settings {
  id    String @id @default(uuid())
  key   String @unique
  value String @db.Text
  updatedAt DateTime @updatedAt
  updatedBy String?
}

// ============================================
// ROLE-BASED ADMIN DASHBOARD SYSTEM
// ============================================

// Staff announcements (company-wide news from Super Admin)
model staff_announcements {
  id              String                    @id @default(uuid())
  title           String
  content         String                    @db.Text
  createdBy       String
  createdByEmail  String
  isActive        Boolean                   @default(true)
  priority        AnnouncementPriority      @default(NORMAL)
  expiresAt       DateTime?
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt

  @@index([isActive])
  @@index([createdAt])
  @@index([priority])
}

// Staff activity feed (cross-department activity log)
model staff_activity_feed {
  id          String   @id @default(uuid())
  userId      String?
  userEmail   String
  userName    String?
  department  String?
  action      String
  entityType  String?
  entityId    String?
  entityName  String?
  description String?  @db.Text
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([department])
  @@index([createdAt])
  @@index([action])
}

// Department access log (track which staff access which dashboards)
model department_access_log {
  id         String   @id @default(uuid())
  userId     String
  userEmail  String
  department String
  pagePath   String
  action     String
  ipAddress  String?
  userAgent  String?  @db.Text
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([department])
  @@index([createdAt])
  @@index([pagePath])
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}
